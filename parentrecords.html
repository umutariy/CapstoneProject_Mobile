<!--html doctype written by Brian Martey-->
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Child Records</title>
    <link rel="shortcut icon" type="image/png" href="eduapp2.png"/>
    <link rel="stylesheet" href="css/foundation.min.css">
    <link rel="stylesheet" href="foundation/fonts/foundation-icons.css"> 
    <link href="css/foundation-icons.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="dist/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="css/student.css">

    <script src="js/jquery.js"></script>
    <script src='lib/moment.min.js'></script>
    <script src="dist/sweetalert.min.js"></script>
  </head>
  <body>
<div class="off-canvas-wrapper">
  <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

    <!-- off-canvas title bar for 'small' screen -->
    <div class="title-bar callout primary medium head" data-responsive-toggle="widemenu" data-hide-for="medium">
      <div class="title-bar-left">
        <ul class="menu">
          <li><a href="#"><i class="icons fi-list" type="button" data-open="offCanvasLeft"></i></a></li>
        </ul>
      </div>
      <div class="title-bar-right">
        <a><img class="circularimage" src="eduapp.png" alt="logo.jpg" id ="applogo"></a>
      </div>
    </div>

    <!-- off-canvas left menu -->
    <div class="off-canvas position-left" id="offCanvasLeft" data-off-canvas>

      <!-- Close button -->
      <button class="close-button" aria-label="Close menu" type="button" data-close>
        <span aria-hidden="true">&times;</span>
      </button>

      <ul class="vertical dropdown menu" data-dropdown-menu>

        <li><a class="text-center"><img class="bigcircularimage" src="" alt="profile.jpg" id ="profilephoto1"></a></li>
        <li><br></li>
        <li><a class="hollowbutton button" href="parentpage.html"><i class="icons fi-arrow-left"></i><span>Back</span></a></li>
        <li><a class="hollowbutton button" href="parentusers.html"><i class="icons fi-male-female"></i><span>Children</span></a></li>
        <li><a class="hollowbutton button" href="parentassignments.html"><i class="icons fi-list-thumbnails"></i><span>Assignments</span></a></li>
        <li><br></br></li>
        <li><br></br></li>
        <li class="text-center"><button id="logout1" class="hollowbutton button" href="#">Sign Out</button></li>
      </ul>
    </div>

    <!-- "wider" top-bar menu for 'medium' and up -->
    <div id="widemenu" class="widemenu callout primary medium head">
      <div class="row columns small-12 medium-12 large-12">
        <div class="columns small-4 medium-4 large-4">
        <ul class="menu align-left">
          <li><a href="parentpage.html"><i class="icons fi-arrow-left"></i></a></li>
          <li>
            <ul class="dropdown menu" data-dropdown-menu>
              <li>
                <a href="#"><i class="icons fi-list"></i></a>
                <ul class="menu">
                  <li><a href="parentusers.html"><i class="icons fi-male-female"></i><span>Children</span></a></li>
                  <li><a href="parentassignments.html"><i class="icons fi-list-thumbnails"></i><span>Assignments</span></a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
        </div>
        <div class="columns small-4 medium-4 large-4">
        <ul class="menu-centered">
          <a><img class="circularimage float-center" src="" alt="profile.jpg" id ="profilephoto2" ></a>
        </ul>
        </div>
        <div class="columns small-4 medium-4 large-4">  
        <ul class="menu align-right">
          <li><button id="logout2" class="hollowbutton hollow button" href="#">Sign Out</button></li>
        </ul>
        </div>
      </div>
    </div>

    <!-- original content goes in this container -->
    <div class="off-canvas-content" data-off-canvas-content>
      <div class="widebody">  
        <div class="innerwidebody">
          <div class="callout">
            <fieldset class="fieldset">
            <legend>Records</legend>
                <div id="overbutt" class="row columns small-12 medium-12 large-12" style="display: none;">
                    <a href="#" class="expanded button" onclick="showOverall()">Overall Graph</a>
                </div>
                <div id="hidebutt" class="row columns small-12 medium-12 large-12">
                    <a href="#" class="expanded button" onclick="hideOverall()">Hide Overall Graph</a>
                </div>
                <div id="container"Â style="min-width: 650px; height: 400px; width: 95%;"></div>
                <div id="wardsbutt" class="row columns small-12 medium-12 large-12">
                    <a href="#" class="expanded button" onclick="showWards()">Show Wards</a>
                </div>
                <div id="nowardsbutt" class="row columns small-12 medium-12 large-12" style="display: none;">
                    <a href="#" class="expanded button" onclick="hideWards()">Hide Wards</a>
                </div>
                <div id="wards" class="row columns small-12 medium-12 large-12" style="display: none;">
                    <div id="plist" class="row columns medium-12">
                </div>
              </div>
            </fieldset>
          </div>         
        </div>
        <div class="hide-for-small-only">
          <div class="text-center">
            <a><img class="circularimage" src="eduapp.png" alt="logo.jpg" id ="applogo"></a>
          </div>
        </div>
      </div>
    </div>

  <!-- close wrapper, no more content after this -->
  </div>
</div>


    <script src="js/foundation.min.js"></script>
    <script src="js/foundation.js"></script>
    <script src="js/highstock.js"></script>
    <script src="js/highcharts-3d.js"></script>
    <script src="js/exporting.js"></script> 
    <script type="text/javascript" src="charts/loader.js"></script>
    <script src="js/foundation/foundation.offcanvas.js"></script>
    <script src="js/student.js"></script>

    <script type="text/javascript">
    $(document).ready(function() {
      var parentinfo = sessionStorage.getItem('parentdata');
      var parsedinfo = JSON.parse(parentinfo);
      document.getElementById("profilephoto1").src = parsedinfo.photo;
      document.getElementById("profilephoto2").src = parsedinfo.photo;

      jQuery(document ).ajaxComplete( function($) {
        jQuery(this).foundation();
      });

    });

    var csserver = "http://cs.ashesi.edu.gh/~brian.martey/applied_2017_spring/eduapp/";

    var parentinfo = sessionStorage.getItem('parentdata');
    var parsedinfo = JSON.parse(parentinfo);
    var children = parsedinfo.children;
    var starray = [];
    var names = [];
    starray = children.split(',');
    var jsnarray = JSON.stringify(starray);

    var stid = starray[0];
    var name = parsedinfo.fname+" "+parsedinfo.lname;

    //pie chart
    var url1 = csserver+'gradesparentservice.php';
    var pie_processed_grades = new Array();  
    var bar_processed_grades = new Array();
    var bar_processed_grades_name = new Array();
    var series_processed_grades_dates = new Array();
    var sum = '';

    $.ajax({
      type: 'POST',
      url: csserver+'usersservice.php?cmd=12&id='+jsnarray,
      success: function(data)
        {
          var info = JSON.parse(data);
          var postlist = '<ul class="accordion" data-accordion data-allow-all-closed="true">';
          for(var j = 0; j < starray.length; j++) {
            postlist+= '<li class="accordion-item" data-accordion-item><a class="accordion-title" href="#">'+info[j]+'</a>';
            postlist+= '<div class="accordion-content" data-tab-content>';
            postlist+= '<h4 id="showbutton'+j+'"><a class="hollow button expanded" href="#" onclick="swap('+j+','+starray[j]+')">Show Graphs</a></h4>';
            postlist+= '<h4 id="showsbutton'+j+'" style="display:none"><a class="hollow button expanded" href="#" onclick="swapin('+j+','+starray[j]+')">Show Graphs</a></h4>';
            postlist+= '<h4 id="hidebutton'+j+'" style="display:none"><a class="button expanded" href="#" onclick="swapout('+j+','+starray[j]+')">Hide Graphs</a></h4>';
            postlist+= '<div id=graphlist'+j+'></div>';
            postlist+= '</div>';
            postlist+= '</li>';
          }
          postlist+='</ul>';
          jQuery('#plist').html(postlist);
        }
    });

    var options = [],
        counter = 0;

    function createChart() {

        Highcharts.stockChart('container', {

            rangeSelector: {
                selected: 4
            },

            title: {
                text: 'Overall Assignments Per Day'
            },

            tooltip: {
                pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> Assignments<br/>',
                split: true
            },

            plotOptions: {
                series: {
                    compare: 'percent',
                    showInNavigator: true
                }
            },

            series: options
        });
    }

    $.each(starray, function (i, id) {

        $.getJSON(csserver+'usersservice.php?cmd=13&id='+id,    function (namedata) {
            names.push(namedata);

            $.getJSON(url1+'?chart=multiseries&stid='+id,    function (data) {

                options[i] = {
                    name: names[i],
                    data: data
                };

                counter += 1;

                if (counter === starray.length) {
                    createChart();
                }
            });
        });
    });

    function showOverall(){
        $("#container").show();
        $("#overbutt").hide();
        $("#hidebutt").show();
    }

    function hideOverall(){
        $("#container").hide();
        $("#overbutt").show();
        $("#hidebutt").hide();
    }

    function showWards(){
        $("#wardsbutt").hide();
        $("#nowardsbutt").show();
        $("#wards").show();
    }

    function hideWards(){
        $("#wardsbutt").show();
        $("#nowardsbutt").hide();
        $("#wards").hide();
    }

    function swap(num,id){
      $('#hidebutton'+num).show();
      $('#showbutton'+num).hide();
      creategraphs(num,id);

    }

    function swapin(num,id){
      $('#hidebutton'+num).show();
      $('#showsbutton'+num).hide();
      showgraphs(num,id);

    }

    function swapout(num,id){
      $('#hidebutton'+num).hide();
      $('#showsbutton'+num).show();
      hidegraphs(num,id);
    } 

    function graph(num,id){
      $.getJSON(url1+"?chart=bar&stid="+id, function (data2) {

        for (i = 0; i < data2.length; i++){
            bar_processed_grades.push([data2[i].name, parseInt(data2[i].y)]);
            bar_processed_grades_name.push([data2[i].name]);
            sum += parseInt(data2[i].y);
        }
        
        Highcharts.chart('container'+num+'h'+id, {
            chart: {
                type: 'column'
            },
            title: {
                text: 'Grade Sums'
            },
            subtitle: {
                text: 'Representation of assignment results'
            },
            xAxis: {
                categories: bar_processed_grades_name
            },
            yAxis: {
                title: {
                    text: 'Grade Totals'
                }

            },
            legend: {
                enabled: false
            },
            plotOptions: {
                series: {
                    borderWidth: 0,
                    dataLabels: {
                        enabled: true,
                        format: '{point.y:.f}'
                    }
                }
            },

            tooltip: {
                headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y}</b> Total grades.<br/>'
            },

            series: [{
                name: 'Grades',
                colorByPoint: true,
                data: bar_processed_grades
            }]
        });
      });

    $.getJSON(url1+"?chart=series&stid="+id, function (data3) {

        for (i = 0; i < data3.length; i++){
            series_processed_grades_dates.push([parseInt(data3[i].x), parseInt(data3[i].y)]);
        }

        Highcharts.stockChart('container'+num+'hh'+id, {
            rangeSelector: {
                selected: 1
            },

            title: {
                text: 'Marks Over Time'
            },

            series: [{
                name: 'Marks',
                data: series_processed_grades_dates,
                tooltip: {
                    valueDecimals: 2
                }
            }]
        });
      });

    bar_processed_grades_name = [];
    bar_processed_grades = [];
    series_processed_grades_dates = [];
    }

    function creategraphs(num,id) {
        var div = document.getElementById("graphlist"+num);
        div1 = document.createElement("div");
        div1.setAttribute('id','container'+num+'h'+id);
        div.appendChild(div1); 
        div2 = document.createElement("div");
        div2.setAttribute('id','container'+num+'hh'+id);
        div.appendChild(div2); 
        graph(num,id);
    }

    function showgraphs(num,id) {
      $('#container'+num+'h'+id).show();
      $('#container'+num+'hh'+id).show();
    } 

    function hidegraphs(num,id) {
      $('#container'+num+'h'+id).hide();
      $('#container'+num+'hh'+id).hide();
    }

    $('#logout1').click(function(event) {
        event.preventDefault();
        sessionStorage.removeItem('parentdata');
        window.location.href = "index.html";
      });

    $('#logout2').click(function(event) {
        event.preventDefault();
        sessionStorage.removeItem('parentdata');
        window.location.href = "index.html";
      });

    </script>

  </body>
</html>
